dev.local {
    # Enable automatic HTTPS with self-signed certificate for local development
    tls internal

    # Logging
    log {
        output stdout
        format console
    }

    # API routes (proxy to NestJS on port 3001)
    handle /api* {
        reverse_proxy host.docker.internal:3001 {
            header_up Host {http.request.host}
            header_up X-Real-IP {http.request.remote}
            header_up X-Forwarded-For {http.request.remote}
            header_up X-Forwarded-Proto {http.request.scheme}
        }
    }

    # Swagger docs (proxy to NestJS on port 3001)
    handle /docs* {
        reverse_proxy host.docker.internal:3001 {
            header_up Host {http.request.host}
            header_up X-Real-IP {http.request.remote}
            header_up X-Forwarded-For {http.request.remote}
            header_up X-Forwarded-Proto {http.request.scheme}
        }
    }

    # Next.js dev server (proxy to port 3000)
    handle {
        reverse_proxy host.docker.internal:3000 {
            header_up Host {http.request.host}
            header_up X-Real-IP {http.request.remote}
            header_up X-Forwarded-For {http.request.remote}
            header_up X-Forwarded-Proto {http.request.scheme}
        }
    }
}
